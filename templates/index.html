<!DOCTYPE html>
<html>
<head>
    <title>Azure OpenAI Chat</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 40px auto; }
        #chat { height: 70vh; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
        .user { text-align: right; color: blue; }
        .assistant { text-align: left; color: green; }
        input { width: 80%; padding: 10px; }
        button { padding: 10px; }
    </style>
</head>
<body>
    <h1>Azure OpenAI Chat (GPT-4o-mini)</h1>
    <div id="chat"></div>
    <input type="text" id="prompt" placeholder="Type your message..." autocomplete="off"/>
    <button onclick="send()">Send</button>

    <script>
        const chat = document.getElementById('chat');
        const prompt = document.getElementById('prompt');
        let messages = [{role: "system", content: "You are a helpful assistant."}];

        function addMessage(content, role) {
            const div = document.createElement('div');
            div.textContent = content;
            div.className = role;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        async function send() {
            const text = prompt.value.trim();
            if (!text) return;
            addMessage(text, 'user');
            messages.push({role: "user", content: text});
            prompt.value = '';

            const response = await fetch('/chat', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({messages})
            });

            const assistantDiv = document.createElement('div');
            assistantDiv.className = 'assistant';
            chat.appendChild(assistantDiv);

            const reader = response.body.getReader();
            let result = '';
            while (true) {
                const {done, value} = await reader.read();
                if (done) break;
                const chunk = new TextDecoder().decode(value);
                result += chunk;
                assistantDiv.textContent = result;
                chat.scrollTop = chat.scrollHeight;
            }
            messages.push({role: "assistant", content: result});
        }

        prompt.addEventListener("keypress", e => { if (e.key === "Enter") send(); });
    </script>
</body>
</html>